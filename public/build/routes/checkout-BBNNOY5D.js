import{c as z}from"/build/_shared/chunk-TWJXAZ2V.js";import"/build/_shared/chunk-WCZYJH7Q.js";import{a as $}from"/build/_shared/chunk-55MVXPGZ.js";import{a as Se}from"/build/_shared/chunk-TKVMG44Y.js";import{b as kt,d as L,g as W,h as o,i as p,q as K}from"/build/_shared/chunk-4JAR5RLY.js";var re=kt((G,ke)=>{p();(function(i,n){typeof G=="object"&&typeof ke<"u"?n(G,W()):typeof define=="function"&&define.amd?define(["exports","react"],n):(i=i||self,n(i.ReactStripe={},i.React))})(G,function(i,n){"use strict";n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;function a(t,e){return e={exports:{}},t(e,e.exports),e.exports}var u="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",l=u;function E(){}function O(){}O.resetWarningCache=E;var N=function(){function t(s,g,d,y,k,c){if(c!==l){var C=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw C.name="Invariant Violation",C}}t.isRequired=t;function e(){return t}var r={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:O,resetWarningCache:E};return r.PropTypes=r,r},f=a(function(t){t.exports=N()});function w(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?w=function(e){return typeof e}:w=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(t)}function M(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function m(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(g){return Object.getOwnPropertyDescriptor(t,g).enumerable})),r.push.apply(r,s)}return r}function B(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?m(Object(r),!0).forEach(function(s){M(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function Q(t,e){return J(t)||R(t,e)||Z(t,e)||Fe()}function J(t){if(Array.isArray(t))return t}function R(t,e){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var r=[],s=!0,g=!1,d=void 0;try{for(var y=t[Symbol.iterator](),k;!(s=(k=y.next()).done)&&(r.push(k.value),!(e&&r.length===e));s=!0);}catch(c){g=!0,d=c}finally{try{!s&&y.return!=null&&y.return()}finally{if(g)throw d}}return r}}function Z(t,e){if(!!t){if(typeof t=="string")return oe(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oe(t,e)}}function oe(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,s=new Array(e);r<e;r++)s[r]=t[r];return s}function Fe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ee=function(e){var r=n.useRef(e);return n.useEffect(function(){r.current=e},[e]),r.current},A=function(e){return e!==null&&w(e)==="object"},De=function(e){return A(e)&&typeof e.then=="function"},Le=function(e){return A(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},ae="[object Object]",Be=function t(e,r){if(!A(e)||!A(r))return e===r;var s=Array.isArray(e),g=Array.isArray(r);if(s!==g)return!1;var d=Object.prototype.toString.call(e)===ae,y=Object.prototype.toString.call(r)===ae;if(d!==y)return!1;if(!d&&!s)return e===r;var k=Object.keys(e),c=Object.keys(r);if(k.length!==c.length)return!1;for(var C={},b=0;b<k.length;b+=1)C[k[b]]=!0;for(var x=0;x<c.length;x+=1)C[c[x]]=!0;var I=Object.keys(C);if(I.length!==k.length)return!1;var _=e,h=r,H=function(U){return t(_[U],h[U])};return I.every(H)},se=function(e,r,s){return A(e)?Object.keys(e).reduce(function(g,d){var y=!A(r)||!Be(e[d],r[d]);return s.includes(d)?(y&&console.warn("Unsupported prop change: options.".concat(d," is not a mutable property.")),g):y?B(B({},g||{}),{},M({},d,e[d])):g},null):null},Ve="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",ue=function(e){if(e===null||Le(e))return e;throw new Error(Ve)},Ue=function(e){if(De(e))return{tag:"async",stripePromise:Promise.resolve(e).then(ue)};var r=ue(e);return r===null?{tag:"empty"}:{tag:"sync",stripe:r}},te=n.createContext(null);te.displayName="ElementsContext";var We=function(e,r){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(r," in an <Elements> provider."));return e},le=function(e){var r=e.stripe,s=e.options,g=e.children,d=n.useRef(!1),y=n.useRef(!0),k=n.useMemo(function(){return Ue(r)},[r]),c=n.useState(function(){return{stripe:null,elements:null}}),C=Q(c,2),b=C[0],x=C[1],I=ee(r);I!==null&&I!==r&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it."),d.current||(k.tag==="sync"&&(d.current=!0,x({stripe:k.stripe,elements:k.stripe.elements(s)})),k.tag==="async"&&(d.current=!0,k.stripePromise.then(function(h){h&&y.current&&x({stripe:h,elements:h.elements(s)})})));var _=ee(s);return n.useEffect(function(){if(!!b.elements){var h=se(s,_,["clientSecret","fonts"]);h&&b.elements.update(h)}},[s,_,b.elements]),n.useEffect(function(){return function(){y.current=!1}},[]),n.useEffect(function(){var h=b.stripe;!h||!h._registerWrapper||!h.registerAppInfo||(h._registerWrapper({name:"react-stripe-js",version:"1.7.0"}),h.registerAppInfo({name:"react-stripe-js",version:"1.7.0",url:"https://stripe.com/docs/stripe-js/react"}))},[b.stripe]),n.createElement(te.Provider,{value:b},g)};le.propTypes={stripe:f.any,options:f.object};var V=function(e){var r=n.useContext(te);return We(r,e)},$e=function(){var e=V("calls useElements()"),r=e.elements;return r},qe=function(){var e=V("calls useStripe()"),r=e.stripe;return r},pe=function(e){var r=e.children,s=V("mounts <ElementsConsumer>");return r(s)};pe.propTypes={children:f.func.isRequired};var j=function(e){var r=n.useRef(e);return n.useEffect(function(){r.current=e},[e]),function(){r.current&&r.current.apply(r,arguments)}},F=function(){},Qe=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},v=function(e,r){var s="".concat(Qe(e),"Element"),g=function(c){var C=c.id,b=c.className,x=c.options,I=x===void 0?{}:x,_=c.onBlur,h=_===void 0?F:_,H=c.onFocus,ce=H===void 0?F:H,U=c.onReady,st=U===void 0?F:U,me=c.onChange,ut=me===void 0?F:me,de=c.onEscape,lt=de===void 0?F:de,fe=c.onClick,pt=fe===void 0?F:fe,ct=V("mounts <".concat(s,">")),ye=ct.elements,D=n.useRef(null),ne=n.useRef(null),mt=j(st),dt=j(h),ft=j(ce),yt=j(pt),vt=j(ut),St=j(lt);n.useLayoutEffect(function(){if(D.current==null&&ye&&ne.current!=null){var P=ye.create(e,I);D.current=P,P.mount(ne.current),P.on("ready",function(){return mt(P)}),P.on("change",vt),P.on("blur",dt),P.on("focus",ft),P.on("escape",St),P.on("click",yt)}});var ve=ee(I);return n.useEffect(function(){if(!!D.current){var P=se(I,ve,["paymentRequest"]);P&&D.current.update(P)}},[I,ve]),n.useLayoutEffect(function(){return function(){D.current&&D.current.destroy()}},[]),n.createElement("div",{id:C,className:b,ref:ne})},d=function(c){V("mounts <".concat(s,">"));var C=c.id,b=c.className;return n.createElement("div",{id:C,className:b})},y=r?d:g;return y.propTypes={id:f.string,className:f.string,onChange:f.func,onBlur:f.func,onFocus:f.func,onReady:f.func,onClick:f.func,options:f.object},y.displayName=s,y.__elementType=e,y},S=typeof window>"u",He=v("auBankAccount",S),Ke=v("card",S),ze=v("cardNumber",S),Ge=v("cardExpiry",S),Ye=v("cardCvc",S),Xe=v("fpxBank",S),Je=v("iban",S),Re=v("idealBank",S),Ze=v("p24Bank",S),et=v("epsBank",S),tt=v("payment",S),nt=v("paymentRequestButton",S),rt=v("linkAuthentication",S),it=v("shippingAddress",S),ot=v("affirmMessage",S),at=v("afterpayClearpayMessage",S);i.AffirmMessageElement=ot,i.AfterpayClearpayMessageElement=at,i.AuBankAccountElement=He,i.CardCvcElement=Ye,i.CardElement=Ke,i.CardExpiryElement=Ge,i.CardNumberElement=ze,i.Elements=le,i.ElementsConsumer=pe,i.EpsBankElement=et,i.FpxBankElement=Xe,i.IbanElement=Je,i.IdealBankElement=Re,i.LinkAuthenticationElement=rt,i.P24BankElement=Ze,i.PaymentElement=tt,i.PaymentRequestButtonElement=nt,i.ShippingAddressElement=it,i.useElements=$e,i.useStripe=qe,Object.defineProperty(i,"__esModule",{value:!0})})});p();p();p();p();var Te=L(W());p();var q=L(W());var T=L(re());p();var he={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"StripePaymentIntent"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"checkoutModel"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CheckoutModelInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paymentProviders"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"stripe"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createPaymentIntent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"checkoutModel"},value:{kind:"Variable",name:{kind:"Name",value:"checkoutModel"}}}]}]}}]}}]}}]};p();var ge={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"confirmStripeOrder"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"checkoutModel"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CheckoutModelInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"paymentIntentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paymentProviders"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"stripe"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"confirmOrder"},arguments:[{kind:"Argument",name:{kind:"Name",value:"checkoutModel"},value:{kind:"Variable",name:{kind:"Name",value:"checkoutModel"}}},{kind:"Argument",name:{kind:"Name",value:"paymentIntentId"},value:{kind:"Variable",name:{kind:"Name",value:"paymentIntentId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"success"}},{kind:"Field",name:{kind:"Name",value:"orderId"}}]}}]}}]}}]}}]};p();var xe=L(re());p();p();var Ee={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"StripeConfig"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paymentProviders"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"stripe"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"config"}}]}}]}}]}}]};function be(){return z("stripeConfig",()=>$.request(Ee))}p();var X=L(W());p();var Pe="https://js.stripe.com/v3",ht=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Ce="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",gt=function(){for(var n=document.querySelectorAll('script[src^="'.concat(Pe,'"]')),a=0;a<n.length;a++){var u=n[a];if(!!ht.test(u.src))return u}return null},Et=function(n){var a=n&&!n.advancedFraudSignals?"?advancedFraudSignals=false":"",u=document.createElement("script");u.src="".concat(Pe).concat(a);var l=document.head||document.body;if(!l)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return l.appendChild(u),u},bt=function(n,a){!n||!n._registerWrapper||n._registerWrapper({name:"stripe-js",version:"1.23.0",startTime:a})},Y=null,Ct=function(n){return Y!==null||(Y=new Promise(function(a,u){if(typeof window>"u"){a(null);return}if(window.Stripe&&n&&console.warn(Ce),window.Stripe){a(window.Stripe);return}try{var l=gt();l&&n?console.warn(Ce):l||(l=Et(n)),l.addEventListener("load",function(){window.Stripe?a(window.Stripe):u(new Error("Stripe.js not available"))}),l.addEventListener("error",function(){u(new Error("Failed to load Stripe.js"))})}catch(E){u(E);return}})),Y},Pt=function(n,a,u){if(n===null)return null;var l=n.apply(void 0,a);return bt(l,u),l},Ne=Promise.resolve().then(function(){return Ct(null)}),Oe=!1;Ne.catch(function(i){Oe||console.warn(i)});var we=function(){for(var n=arguments.length,a=new Array(n),u=0;u<n;u++)a[u]=arguments[u];Oe=!0;var l=Date.now();return Ne.then(function(E){return Pt(E,a,l)})};function Ie(i){let[n,a]=(0,X.useState)(null);return(0,X.useEffect)(()=>{(i==null?void 0:i.data)&&!n&&a(we(i.data.paymentProviders.stripe.config.publishableKey))},[i,n]),n}var Me=({loading:i,children:n})=>{let a=be(),u=Ie(a);return a.isLoading||!u?o.createElement(o.Fragment,null,i):o.createElement(xe.Elements,{stripe:u},n)};var Nt=({stripeClientSecret:i,checkoutModel:n,onSuccess:a,onError:u=l=>console.log(l)})=>{let l=(0,T.useStripe)(),E=(0,T.useElements)(),[O,N]=(0,q.useState)("idle");return(0,q.useEffect)(()=>{l&&l.elements({fonts:[{cssSrc:"https://fonts.googleapis.com/css?family=Roboto"}]})},[l]),o.createElement(K,{method:"post",onSubmit:async w=>{w.preventDefault(),M();async function M(){if(N("submitting"),!l||!E){setTimeout(M,100),console.log("checking in");return}let{customer:m}=n,{error:B,paymentIntent:Q}=await l.confirmCardPayment(i,{payment_method:{card:E.getElement(T.CardElement),billing_details:{name:`${m.firstName} ${m.lastName}`}}});if(B){u(new Error(B.message)),N("idle");return}if(Q.status!=="succeeded"){N("idle");return}let J=await $.request(ge,{checkoutModel:n,paymentIntentId:Q.id}),{success:R,orderId:Z}=J.paymentProviders.stripe.confirmOrder;R?window.location.replace(`/confirmation/${Z}`):(N("idle"),u(new Error("Unknown")))}}},o.createElement(T.CardElement,{options:{style:{base:{color:"#000",fontSize:"14px"}}},className:"mt-8 mb-5 border-2 border-text p-5"}),o.createElement("button",{type:"submit",disabled:O!=="idle",className:"w-full bg-text text-primary py-3 font-semibold mt-5"},O==="idle"?"Pay":"Hang on..."))},Ot=({checkoutModel:i,onSuccess:n})=>{var E,O,N,f;let a=z("paymentIntent",()=>$.request(he,{checkoutModel:i}),{enabled:!1});(0,q.useEffect)(()=>{a.refetch()},[]);let u=o.createElement("p",null,"Loading...");if(!a.data)return u;let l=(f=(N=(O=(E=a==null?void 0:a.data)==null?void 0:E.paymentProviders)==null?void 0:O.stripe)==null?void 0:N.createPaymentIntent)==null?void 0:f.client_secret;return o.createElement(Me,{loading:u},o.createElement(Nt,{stripeClientSecret:l,checkoutModel:i,onSuccess:n}))},_e=({checkoutModel:i,onSuccess:n})=>o.createElement(Ot,{checkoutModel:i,onSuccess:n});var ie=i=>{let[n,a]=(0,Te.useState)("");return o.createElement(o.Fragment,null,o.createElement("div",null,o.createElement("button",{onClick:()=>a("stripe"),className:"w-full bg-text text-primary py-3 font-semibold mt-5"},"Stripe")),n==="stripe"&&o.createElement(_e,{...i}))};var Ae=L(W());function je(){let[i,n]=(0,Ae.useState)({firstName:"",lastName:"",email:"",street:"",city:"",postalCode:""}),{firstName:a,lastName:u,email:l,street:E,city:O,postalCode:N}=i,f=Se();function w(m){return typeof window=="undefined"?"":`${location==null?void 0:location.protocol}//${location==null?void 0:location.host}${m}`}let M={basketModel:f.basketModel,customer:{firstName:a,lastName:u,addresses:[{type:"billing",email:l},{type:"delivery",street:E,city:O,postalCode:N}]},confirmationURL:w("/confirmation/{crystallizeOrderId}"),checkoutURL:w("/checkout"),termsURL:w("/terms")};return o.createElement("div",{className:"p-10 mx-auto bg-background1 w-128 mt-20"},o.createElement("h1",{className:"text-text text-3xl font-bold mb-10 text-center"},"Checkout"),o.createElement("div",{className:"mx-auto"},o.createElement(K,{method:"post",className:"flex flex-wrap gap-5"},o.createElement("input",{type:"text",name:"First Name",placeholder:"First name",className:"w-full",onChange:m=>n({...i,firstName:m.target.value})}),o.createElement("input",{type:"text",name:"Last Name",placeholder:"Last name",className:"w-full",onChange:m=>n({...i,lastName:m.target.value})}),o.createElement("input",{type:"text",name:"Email",placeholder:"Email",className:"w-full",onChange:m=>n({...i,email:m.target.value})}),o.createElement("input",{type:"text",name:"Street",placeholder:"Street",className:"w-full",onChange:m=>n({...i,street:m.target.value})}),o.createElement("input",{type:"text",name:"City",placeholder:"City",className:"w-full",onChange:m=>n({...i,city:m.target.value})}),o.createElement("input",{type:"text",name:"Postal Code",placeholder:"Postal Code",className:"w-full",onChange:m=>n({...i,postalCode:m.target.value})}))),o.createElement(ie,{checkoutModel:M,onSuccess:()=>console.log("success"),onError:()=>{}}))}export{je as default};
